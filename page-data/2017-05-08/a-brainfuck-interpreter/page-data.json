{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017-05-08/a-brainfuck-interpreter/","result":{"data":{"site":{"siteMetadata":{"title":"The Coding Disappointment"}},"markdownRemark":{"id":"9827d74d-80e0-5103-b02d-fac7d7babcb1","excerpt":"Brainfuck, it's easy as 1-2-3 I’m sure you’ve heard of this simple little esoteric programming language, or at least seen that garble of text somewhere whenever there’s a discussion on languages that wanna make you tear your hair out. While it’s not…","timeToRead":5,"html":"<p><a href=\"https://imgur.com/ctCM6rb\"><img src=\"https://i.imgur.com/ctCM6rb.png\" alt=\"Brainfuck, it&#x27;s easy as 1-2-3\"></a></p>\n<p>I’m sure you’ve heard of this simple little <em>esoteric</em> programming language, or at least seen that garble of text somewhere whenever there’s a discussion on languages that wanna make you tear your hair out. While it’s not Malbolge levels of torture, it’s simple construct can actually be really confusing to deal with if you don’t track what’s happening carefully.</p>\n<p>Let’s take a quick look at the language. There are no identifiers, syntax or anything like any programming language you would use for real applications. Only eight basic commands are used in Brainfuck - ”.”, ”,”, ”+”, ”-”, ”>”, ”&#x3C;”, ”[” and ”]”. All data related operations occur on an (theoretically) infinite sequence of cells, making it operate similar to a Turing machine. Using the eight commands, you can perform various tasks, and the language is Turing complete.</p>\n<p>Although the commands are very simple, if the task becomes even slightly complex, the code can look very messy or very confusing, depending if you want to keep the code simple or efficient. So, although theoretically the language can perform a wide range of tasks, you obviously wouldn’t want to use it anyways because of the problems it can cause.</p>\n<p>Seeing that all the language consists of only single character commands, coding a compiler and interpreter should be pretty simple. The only real problem is having infinite cells for the program to write into. This could be solved through dynamic allocation of cells as and when required, and this is limited by the heap memory available.</p>\n<p>So I decided, since this was a very simple language, to write a interpreter and compiler for it. First I started off with the interpreter, seeing that it would be simpler. I created some basic basic data structures for use by the interpreter.</p>\n<ul>\n<li>A data structure for the nodes of the cell that form a double linked list, for two-way traveral.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">program_list_node</span> <span class=\"token punctuation\">{</span>\n    uint8_t value<span class=\"token punctuation\">;</span>                            <span class=\"token comment\">//The value of the node in the list.</span>\n    <span class=\"token keyword\">struct</span>  <span class=\"token class-name\">program_list_node</span> <span class=\"token operator\">*</span>previous_node<span class=\"token punctuation\">;</span> <span class=\"token comment\">//The pointer to the previous node in the list, if any.</span>\n    <span class=\"token keyword\">struct</span>  <span class=\"token class-name\">program_list_node</span> <span class=\"token operator\">*</span>next_node<span class=\"token punctuation\">;</span>     <span class=\"token comment\">//The pointer to the next node in the list, if any.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>A data structure for the loop control that form a stack. The nodes just store the position in the program file where the loop starts.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">loop_stack_node</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> start_pointer_position<span class=\"token punctuation\">;</span>           <span class=\"token comment\">//The input pointer position for the start of the loop.</span>\n    <span class=\"token keyword\">struct</span>    <span class=\"token class-name\">loop_stack_node</span> <span class=\"token operator\">*</span>outer_loop_node<span class=\"token punctuation\">;</span> <span class=\"token comment\">//The pointer to the outer loop of the loop, if any.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>A data structure to store the instruction pointers’ current positiona and value.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">input_pointer</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> position<span class=\"token punctuation\">;</span> <span class=\"token comment\">//Current position of the input pointer.</span>\n    <span class=\"token keyword\">char</span>      value<span class=\"token punctuation\">;</span>    <span class=\"token comment\">//Value of the character in the current input position.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>A data structure for storing the source file pointer, the instruction pointer details as well as the interpreter status and message.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">input_file</span> <span class=\"token punctuation\">{</span>\n    FILE                 <span class=\"token operator\">*</span>source<span class=\"token punctuation\">;</span>        <span class=\"token comment\">//The program file being interpreted.</span>\n    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">input_pointer</span> pointer<span class=\"token punctuation\">;</span>        <span class=\"token comment\">//The current input position details.</span>\n    uint8_t              status<span class=\"token punctuation\">;</span>         <span class=\"token comment\">//The status of the program being interpreted.</span>\n    <span class=\"token keyword\">char</span>                 message<span class=\"token punctuation\">[</span><span class=\"token number\">65536</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//A message about the current status of the program being interpreted.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>A data structure that stores the current cells’ address and the top loops’ address.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">program_list</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">program_list_node</span> <span class=\"token operator\">*</span>list_position<span class=\"token punctuation\">;</span> <span class=\"token comment\">//The pointer to the current position in the program list.</span>\n    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">loop_stack_node</span>   <span class=\"token operator\">*</span>loop_top<span class=\"token punctuation\">;</span>      <span class=\"token comment\">//The pointer to the current position in the loop.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>Finally, a data structure that contains the previous two data structures, as well as the program input and output files.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">program_details</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">input_file</span>   file<span class=\"token punctuation\">;</span>     <span class=\"token comment\">//The program file.</span>\n    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">program_list</span> list<span class=\"token punctuation\">;</span>     <span class=\"token comment\">//The program list</span>\n    FILE                <span class=\"token operator\">*</span>progin<span class=\"token punctuation\">;</span>  <span class=\"token comment\">//The program input file.</span>\n    FILE                <span class=\"token operator\">*</span>progout<span class=\"token punctuation\">;</span> <span class=\"token comment\">//The program output file.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The program quickly checks whether certain parameters have been provided. These then get passed to an initializer function that sets up the values of the data structures. Control is then handed over to the interpreter execution function, which uses the rules of the language dispersed through various functions to execute the brainfuck code. Upon completion, a cleanup function to clear away the data structures is called and finally the interpreter ends its execution.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span> argc <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span> argc <span class=\"token operator\">></span> <span class=\"token number\">5</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span> <span class=\"token comment\">//Check if parameters have been provided for interpretation and execution of a program.</span>\n<span class=\"token function\">interpreter_init</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">,</span> input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//Initialize the interpreter.</span>\n<span class=\"token function\">interpreter_exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                       <span class=\"token comment\">//Execute the interpreter.</span>\n<span class=\"token function\">interpreter_clean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                      <span class=\"token comment\">//Clean up after the interpreter.</span>\n<span class=\"token keyword\">return</span> program<span class=\"token punctuation\">.</span>file<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">;</span>               <span class=\"token comment\">//Return the final program status.</span></code></pre></div>\n<p>There is only one kind of error that can occur in a Brainfuck program, and that’s unmatched loop braces. The program handles this by halting execution and terminating immediately, with an error message stating the error and the byte location where the error occured. The interpreter can also run out of heap memory for execution. There is no error handling for such a situation, which I need to take care of. This error can be temporarily fixed by compiling the interpreter code to start out with more heap memory so as to overflow on it. It’s not the perfect solution, but it’ll do and is better than just throwing an error for such type of errors.</p>\n<p>Another kind of error can occur - when the source file or program input file cannot be opened. This also leads to halting of the program and termination. The only change required here is to allow non-existence of a program file input IF the Brainfuck program requires no input. Parsing through the entire file searching for even a single input command should work for this case, although for very lengthy programs it can take time. Another option is to not care and start execution until an input is requested, and only throw an error when such a scenario is reached. I’ll most likely opt for the latter approach, since it keeps things simpler and faster.</p>\n<p>The interpreter source code, along with a Windows and Linux executable, is available at Github. The Windows executuble was compiled using Orwell Dev-C++, and the Linux executable was compiled using GCC 5.4.0 on the Ubuntu Linux Layer added onto Windows with no changes in C code between the two (since I did try to ensure to use simple, cross-platform code).</p>\n<p>The compiler side of things may be a bit trickier to implement. The lexical, syntax and semantic analysis can be skipped, since all commands are independent and single character only, allowing for super simple parsing. The only problem to deal with is handling the sequence of cells, although I do have an idea for that. I also plan to compile to LLVM, to allow for platform-agnostic compilation. The LLVM code then be compiled manually to machine dependent code which I will leave to the end user of the compiler. However, I don’t plan on starting working on the compiler anytime soon, and optimizations to the interpreter won’t be a priority for me as well, since I plan to work on a mini-learning project in Unity just to get a hang of things with the engine.</p>\n<p>The link to the Github repo with the complete code and executables is <a href=\"https://github.com/sabarnac/brainf-interpreter-compiler\">https://github.com/sabarnac/brainf-interpreter-compiler</a></p>\n<p>Hope you guys have a good day! :D</p>","frontmatter":{"title":"A Brainfuck Interpreter","date":"May 08, 2017"}}},"pageContext":{"slug":"/2017-05-08/a-brainfuck-interpreter/","previous":{"fields":{"slug":"/2017/05/01/welcome-to-my-blog/"},"frontmatter":{"title":"Welcome to My Blog!"}},"next":{"fields":{"slug":"/2017-05-23/create-to-maintain/"},"frontmatter":{"title":"Create To Maintain"}}}}}